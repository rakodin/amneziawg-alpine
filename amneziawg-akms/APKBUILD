pkgname=amneziawg-akms
pkgver="1.0.20251009"
pkgrel=1
pkgdesc="Amneziawg 1.5 linux kernel module"
license="GPL-2.0-only"
url="https://amnezia.org"
arch="x86_64"
options="!check"
maintainer="DP <rak1@oxff.me.in>"
depends="akms"
source="amneziawg-linux-kernel-module-$pkgver.tar.gz::https://github.com/amnezia-vpn/amneziawg-linux-kernel-module/archive/refs/tags/v1.0.20251009.tar.gz"
builddir="amneziawg-linux-kernel-module-$pkgver"

unpack() {
	default_unpack
	cat >$srcdir/AKMBUILD <<-EOF
	modname=$pkgname
	modver=$pkgver
	built_modules="amneziawg.ko"
	EOF
}

package() {
	local destdir="$pkgdir/usr/src/$pkgname-$pkgver"
	local fromdir="$srcdir/amneziawg-linux-kernel-module-$pkgver/src"
	install -Dm644 -t "$destdir" $srcdir/AKMBUILD
	cp -r $fromdir/* "$destdir"
}

sha512sums="
1c807df0e54fa79f50c055229fe75a4289febd272c304528f5cfe57271aecfe2fb5a8c4480c82f527e1b0272bfae73e03b5b06119769e98d37bb4df65844f2ff  amneziawg-linux-kernel-module-$pkgver.tar.gz
"
