pkgname=amneziawg-akms
pkgver="1.0.20251104"
pkgrel=0
pkgdesc="Amneziawg 1.5 linux kernel module"
license="GPL-2.0-only"
url="https://amnezia.org"
arch="x86_64"
options="!check"
maintainer="DP <rak1@oxff.me.in>"
depends="akms"
source="amneziawg-linux-kernel-module-$pkgver.tar.gz::https://github.com/amnezia-vpn/amneziawg-linux-kernel-module/archive/refs/tags/v${pkgver}.tar.gz"
builddir="amneziawg-linux-kernel-module-$pkgver"

unpack() {
	default_unpack
	cat >$srcdir/AKMBUILD <<-EOF
	modname=$pkgname
	modver=$pkgver
	built_modules="amneziawg.ko"
	EOF
}

package() {
	local destdir="$pkgdir/usr/src/$pkgname-$pkgver"
	local fromdir="$srcdir/amneziawg-linux-kernel-module-$pkgver/src"
	install -Dm644 -t "$destdir" $srcdir/AKMBUILD
	cp -r $fromdir/* "$destdir"
}

sha512sums="
5a6962d6cf49b97facd0ffa724a7a15b8736f7774086e0cc260ceac86d728ad8d72b42f8e6df4912bdd64ec17bbc732ba0540592996bda10221dfa87b1414bc9  amneziawg-linux-kernel-module-$pkgver.tar.gz
"
